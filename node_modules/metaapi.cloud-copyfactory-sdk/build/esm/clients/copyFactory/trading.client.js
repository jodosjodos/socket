'use strict';
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}
function _async_to_generator(fn) {
    return function() {
        var self = this, args = arguments;
        return new Promise(function(resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}
import MetaApiClient from '../metaApi.client';
import SignalClient from './signal.client';
import StopoutListenerManager from './streaming/stopoutListenerManager';
import UserLogListenerManager from './streaming/userLogListenerManager';
let TradingClient = class TradingClient extends MetaApiClient {
    /**
   * Resynchronizes the account. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/resynchronize/
   * @param {String} accountId account id
   * @param {Array<String>} [strategyIds] array of strategy ids to recynchronize. Default is to synchronize all
   * strategies
   * @param {Array<String>} [positionIds] array of position ids to resynchronize. Default is to synchronize all
   * positions
   * @return {Promise} promise which resolves when resynchronization is scheduled
   */ resynchronize(accountId, strategyIds, positionIds) {
        var _this = this;
        return _async_to_generator(function*() {
            if (_this._isNotJwtToken()) {
                return _this._handleNoAccessError('resynchronize');
            }
            const opts = {
                url: `/users/current/subscribers/${accountId}/resynchronize`,
                method: 'POST',
                headers: {
                    'auth-token': _this._token
                },
                params: {
                    strategyId: strategyIds,
                    positionId: positionIds
                },
                json: true
            };
            return _this._domainClient.requestCopyFactory(opts);
        })();
    }
    /**
   * Generates an instance of signal client for an account
   * @param {String} accountId account id
   */ getSignalClient(accountId) {
        var _this = this;
        return _async_to_generator(function*() {
            if (_this._isNotJwtToken()) {
                return _this._handleNoAccessError('getSignalClient');
            }
            let accountData = yield _this._domainClient.getAccountInfo(accountId);
            const host = yield _this._domainClient.getSignalClientHost(accountData.regions);
            return new SignalClient(accountData.id, host, _this._domainClient);
        })();
    }
    /**
   * CopyFactory strategy stopout reason
   * @typedef {'day-balance-difference' | 'date-balance-difference' | 'week-balance-difference' |
   * 'week-to-date-balance-difference' | 'month-balance-difference' | 'month-to-date-balance-difference' |
   * 'quarter-balance-difference' | 'quarter-to-date-balance-difference' | 'year-balance-difference' |
   * 'year-to-date-balance-difference' | 'lifetime-balance-difference' | 'day-balance-minus-equity' |
   * 'date-balance-minus-equity' | 'week-balance-minus-equity' | 'week-to-date-balance-minus-equity' |
   * 'month-balance-minus-equity' | 'month-to-date-balance-minus-equity' |
   * 'quarter-balance-minus-equity' | 'quarter-to-date-balance-minus-equity' | 'year-balance-minus-equity' |
   * 'year-to-date-balance-minus-equity' | 'lifetime-balance-minus-equity' |
   * 'day-equity-difference' | 'date-equity-difference' | 'week-equity-difference' |
   * 'week-to-date-equity-difference' | 'month-equity-difference' |
   * 'month-to-date-equity-difference' | 'quarter-equity-difference' | 'quarter-to-date-equity-difference' |
   * 'year-equity-difference' | 'year-to-date-equity-difference' |
   * 'lifetime-equity-difference'} CopyFactoryStrategyStopoutReason
   */ /**
   * CopyFactory strategy stopout
   * @typedef {Object} CopyFactoryStrategyStopout
   * @property {String} subscriberId subscriber id
   * @property {CopyFactoryStrategyIdAndName} strategy strategy which was stopped out
   * @property {Boolean} partial flag indicating that stopout is partial
   * @property {CopyFactoryStrategyStopoutReason} reason stopout reason
   * @property {String} reasonDescription human-readable description of the stopout reason
   * @property {Boolean} [closePositions] flag indicating if positions should be closed
   * @property {Date} stoppedAt time the strategy was stopped at
   * @property {Date} stoppedTill time the strategy is stopped till
   * @property {Number} sequenceNumber stopout event sequence number
   */ /**
   * Returns subscriber account stopouts. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/getStopOuts/
   * @param {String} subscriberId subscriber id
   * @return {Promise<Array<CopyFactoryStrategyStopout>>} promise which resolves with stopouts found
   */ getStopouts(subscriberId) {
        var _this = this;
        return _async_to_generator(function*() {
            if (_this._isNotJwtToken()) {
                return _this._handleNoAccessError('getStopouts');
            }
            const opts = {
                url: `/users/current/subscribers/${subscriberId}/stopouts`,
                method: 'GET',
                headers: {
                    'auth-token': _this._token
                },
                json: true
            };
            return _this._domainClient.requestCopyFactory(opts);
        })();
    }
    /**
   * Resets subscription stopouts. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/resetSubscriptionStopOuts/
   * @param {String} subscriberId subscriber id
   * @param {String} strategyId strategy id
   * @param {CopyFactoryStrategyStopoutReason} reason stopout reason to reset
   * yearly-equity, monthly-equity, daily-equity
   * @return {Promise} promise which resolves when the stopouts are reset
   */ resetSubscriptionStopouts(subscriberId, strategyId, reason) {
        if (this._isNotJwtToken()) {
            return this._handleNoAccessError('resetSubscriptionStopouts');
        }
        const opts = {
            url: `/users/current/subscribers/${subscriberId}/subscription-strategies/` + `${strategyId}/stopouts/${reason}/reset`,
            method: 'POST',
            headers: {
                'auth-token': this._token
            },
            json: true
        };
        return this._domainClient.requestCopyFactory(opts);
    }
    /**
   * Resets subscriber stopouts. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/resetSubscriberStopOuts/
   * @param {String} subscriberId subscriber id
   * @param {CopyFactoryStrategyStopoutReason} reason stopout reason to reset
   * yearly-equity, monthly-equity, daily-equity
   * @return {Promise} promise which resolves when the stopouts are reset
   */ resetSubscriberStopouts(subscriberId, reason) {
        if (this._isNotJwtToken()) {
            return this._handleNoAccessError('resetSubscriberStopouts');
        }
        const opts = {
            url: `/users/current/subscribers/${subscriberId}/stopouts/${reason}/reset`,
            method: 'POST',
            headers: {
                'auth-token': this._token
            },
            json: true
        };
        return this._domainClient.requestCopyFactory(opts);
    }
    /**
   * Trade copying user log record
   * @typedef {Object} CopyFactoryUserLogMessage
   * @property {Date} time log record time
   * @property {string} [symbol] symbol traded
   * @property {string} [strategyId] id of the strategy event relates to
   * @property {string} [strategyName] name of the strategy event relates to
   * @property {string} [positionId] position id event relates to
   * @property {string} [side] side of the trade event relates to. One of buy, sell, close
   * @property {string} [type] type of the trade event relates to. One of market, limit, stop
   * @property {number} [openPrice] open price for limit and stop orders
   * @property {string} level log level. One of INFO, WARN, ERROR
   * @property {string} message log message
   */ /**
   * Returns copy trading user log for an account and time range. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/getUserLog/
   * @param {String} subscriberId subscriber id
   * @param {Date} [startTime] time to start loading data from
   * @param {Date} [endTime] time to stop loading data at
   * @param {String} [strategyId] strategy id filter
   * @param {String} [positionId] position id filter
   * @param {'DEBUG'|'INFO'|'WARN'|'ERROR'} [level] minimum severity level
   * @param {Number} [offset] pagination offset. Default is 0
   * @param {Number} [limit] pagination limit. Default is 1000
   * @return {Promise<Array<CopyFactoryUserLogMessage>>} promise which resolves with log records found
   */ getUserLog(subscriberId, startTime, endTime, strategyId, positionId, level, offset = 0, limit = 1000) {
        var _this = this;
        return _async_to_generator(function*() {
            if (_this._isNotJwtToken()) {
                return _this._handleNoAccessError('getUserLog');
            }
            const opts = {
                url: `/users/current/subscribers/${subscriberId}/user-log`,
                method: 'GET',
                params: {
                    startTime,
                    endTime,
                    strategyId,
                    positionId,
                    level,
                    offset,
                    limit
                },
                headers: {
                    'auth-token': _this._token
                },
                json: true
            };
            let result = yield _this._domainClient.requestCopyFactory(opts, true);
            if (result) {
                result.map((r)=>r.time = new Date(r.time));
            }
            return result;
        })();
    }
    /**
   * Returns event log for CopyFactory strategy, sorted in reverse chronological order. See
   * https://metaapi.cloud/docs/copyfactory/restApi/api/trading/getStrategyLog/ 
   * @param {String} strategyId strategy id to retrieve log for
   * @param {Date} [startTime] time to start loading data from
   * @param {Date} [endTime] time to stop loading data at
   * @param {String} [positionId] position id filter
   * @param {'DEBUG'|'INFO'|'WARN'|'ERROR'} [level] minimum severity level
   * @param {Number} [offset] pagination offset. Default is 0
   * @param {Number} [limit] pagination limit. Default is 1000
   * @return {Promise<Array<CopyFactoryUserLogMessage>>} promise which resolves with log records found
   */ getStrategyLog(strategyId, startTime, endTime, positionId, level, offset = 0, limit = 1000) {
        var _this = this;
        return _async_to_generator(function*() {
            if (_this._isNotJwtToken()) {
                return _this._handleNoAccessError('getStrategyLog');
            }
            const opts = {
                url: `/users/current/strategies/${strategyId}/user-log`,
                method: 'GET',
                params: {
                    startTime,
                    endTime,
                    positionId,
                    level,
                    offset,
                    limit
                },
                headers: {
                    'auth-token': _this._token
                },
                json: true
            };
            let result = yield _this._domainClient.requestCopyFactory(opts, true);
            if (result) {
                result.map((r)=>r.time = new Date(r.time));
            }
            return result;
        })();
    }
    /**
   * Adds a stopout listener and creates a job to make requests
   * @param {StopoutListener} listener stopout listener
   * @param {String} [accountId] account id
   * @param {String} [strategyId] strategy id
   * @param {Number} [sequenceNumber] sequence number
   * @return {String} listener id
   */ addStopoutListener(listener, accountId, strategyId, sequenceNumber) {
        return this._stopoutListenerManager.addStopoutListener(listener, accountId, strategyId, sequenceNumber);
    }
    /**
   * Removes stopout listener and cancels the event stream
   * @param {String} listenerId stopout listener id
   */ removeStopoutListener(listenerId) {
        this._stopoutListenerManager.removeStopoutListener(listenerId);
    }
    /**
   * Adds a strategy log listener and creates a job to make requests
   * @param {UserLogListener} listener user log listener
   * @param {String} strategyId strategy id
   * @param {Date} [startTime] log search start time
   * @param {String} [positionId] position id filter
   * @param {'DEBUG'|'INFO'|'WARN'|'ERROR'} [level] minimum severity level
   * @param {Number} [limit] log pagination limit
   * @return {String} listener id
   */ addStrategyLogListener(listener, strategyId, startTime, positionId, level, limit) {
        return this._userLogListenerManager.addStrategyLogListener(listener, strategyId, startTime, positionId, level, limit);
    }
    /**
   * Removes strategy log listener and cancels the event stream
   * @param {String} listenerId strategy log listener id
   */ removeStrategyLogListener(listenerId) {
        this._userLogListenerManager.removeStrategyLogListener(listenerId);
    }
    /**
   * Adds a subscriber log listener and creates a job to make requests
   * @param {UserLogListener} listener user log listener
   * @param {String} subscriberId subscriber id
   * @param {Date} [startTime] log search start time
   * @param {string} [strategyId] strategy id filter
   * @param {string} [positionId] position id filter
   * @param {'DEBUG'|'INFO'|'WARN'|'ERROR'} [level] minimum severity level
   * @param {Number} [limit] log pagination limit
   * @return {String} listener id
   */ addSubscriberLogListener(listener, subscriberId, startTime, strategyId, positionId, level, limit) {
        return this._userLogListenerManager.addSubscriberLogListener(listener, subscriberId, startTime, strategyId, positionId, level, limit);
    }
    /**
   * Removes subscriber log listener and cancels the event stream
   * @param {String} listenerId subscriber log listener id
   */ removeSubscriberLogListener(listenerId) {
        this._userLogListenerManager.removeSubscriberLogListener(listenerId);
    }
    /**
   * Constructs CopyFactory trading API client instance
   * @param {DomainClient} domainClient domain client
   */ constructor(domainClient){
        super(domainClient);
        this._domainClient = domainClient;
        this._stopoutListenerManager = new StopoutListenerManager(domainClient);
        this._userLogListenerManager = new UserLogListenerManager(domainClient);
    }
};
/**
 * metaapi.cloud CopyFactory trading API (trade copying trading API) client (see
 * https://metaapi.cloud/docs/copyfactory/)
 */ export { TradingClient as default };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjxhbm9uPiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBNZXRhQXBpQ2xpZW50IGZyb20gJy4uL21ldGFBcGkuY2xpZW50JztcbmltcG9ydCBTaWduYWxDbGllbnQgZnJvbSAnLi9zaWduYWwuY2xpZW50JztcbmltcG9ydCBTdG9wb3V0TGlzdGVuZXJNYW5hZ2VyIGZyb20gJy4vc3RyZWFtaW5nL3N0b3BvdXRMaXN0ZW5lck1hbmFnZXInO1xuaW1wb3J0IFVzZXJMb2dMaXN0ZW5lck1hbmFnZXIgZnJvbSAnLi9zdHJlYW1pbmcvdXNlckxvZ0xpc3RlbmVyTWFuYWdlcic7XG5cbi8qKlxuICogbWV0YWFwaS5jbG91ZCBDb3B5RmFjdG9yeSB0cmFkaW5nIEFQSSAodHJhZGUgY29weWluZyB0cmFkaW5nIEFQSSkgY2xpZW50IChzZWVcbiAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5LylcbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHJhZGluZ0NsaWVudCBleHRlbmRzIE1ldGFBcGlDbGllbnQge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIENvcHlGYWN0b3J5IHRyYWRpbmcgQVBJIGNsaWVudCBpbnN0YW5jZVxuICAgKiBAcGFyYW0ge0RvbWFpbkNsaWVudH0gZG9tYWluQ2xpZW50IGRvbWFpbiBjbGllbnRcbiAgICovXG4gIGNvbnN0cnVjdG9yKGRvbWFpbkNsaWVudCkge1xuICAgIHN1cGVyKGRvbWFpbkNsaWVudCk7XG4gICAgdGhpcy5fZG9tYWluQ2xpZW50ID0gZG9tYWluQ2xpZW50O1xuICAgIHRoaXMuX3N0b3BvdXRMaXN0ZW5lck1hbmFnZXIgPSBuZXcgU3RvcG91dExpc3RlbmVyTWFuYWdlcihkb21haW5DbGllbnQpO1xuICAgIHRoaXMuX3VzZXJMb2dMaXN0ZW5lck1hbmFnZXIgPSBuZXcgVXNlckxvZ0xpc3RlbmVyTWFuYWdlcihkb21haW5DbGllbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3luY2hyb25pemVzIHRoZSBhY2NvdW50LiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvdHJhZGluZy9yZXN5bmNocm9uaXplL1xuICAgKiBAcGFyYW0ge1N0cmluZ30gYWNjb3VudElkIGFjY291bnQgaWRcbiAgICogQHBhcmFtIHtBcnJheTxTdHJpbmc+fSBbc3RyYXRlZ3lJZHNdIGFycmF5IG9mIHN0cmF0ZWd5IGlkcyB0byByZWN5bmNocm9uaXplLiBEZWZhdWx0IGlzIHRvIHN5bmNocm9uaXplIGFsbFxuICAgKiBzdHJhdGVnaWVzXG4gICAqIEBwYXJhbSB7QXJyYXk8U3RyaW5nPn0gW3Bvc2l0aW9uSWRzXSBhcnJheSBvZiBwb3NpdGlvbiBpZHMgdG8gcmVzeW5jaHJvbml6ZS4gRGVmYXVsdCBpcyB0byBzeW5jaHJvbml6ZSBhbGxcbiAgICogcG9zaXRpb25zXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgd2hlbiByZXN5bmNocm9uaXphdGlvbiBpcyBzY2hlZHVsZWRcbiAgICovXG4gIGFzeW5jIHJlc3luY2hyb25pemUoYWNjb3VudElkLCBzdHJhdGVneUlkcywgcG9zaXRpb25JZHMpIHtcbiAgICBpZiAodGhpcy5faXNOb3RKd3RUb2tlbigpKSB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlTm9BY2Nlc3NFcnJvcigncmVzeW5jaHJvbml6ZScpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvJHthY2NvdW50SWR9L3Jlc3luY2hyb25pemVgLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdhdXRoLXRva2VuJzogdGhpcy5fdG9rZW5cbiAgICAgIH0sXG4gICAgICBwYXJhbXM6IHtcbiAgICAgICAgc3RyYXRlZ3lJZDogc3RyYXRlZ3lJZHMsXG4gICAgICAgIHBvc2l0aW9uSWQ6IHBvc2l0aW9uSWRzXG4gICAgICB9LFxuICAgICAganNvbjogdHJ1ZVxuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2RvbWFpbkNsaWVudC5yZXF1ZXN0Q29weUZhY3Rvcnkob3B0cyk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIGFuIGluc3RhbmNlIG9mIHNpZ25hbCBjbGllbnQgZm9yIGFuIGFjY291bnRcbiAgICogQHBhcmFtIHtTdHJpbmd9IGFjY291bnRJZCBhY2NvdW50IGlkXG4gICAqL1xuICBhc3luYyBnZXRTaWduYWxDbGllbnQoYWNjb3VudElkKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFNpZ25hbENsaWVudCcpO1xuICAgIH1cblxuICAgIGxldCBhY2NvdW50RGF0YSA9IGF3YWl0IHRoaXMuX2RvbWFpbkNsaWVudC5nZXRBY2NvdW50SW5mbyhhY2NvdW50SWQpO1xuICAgIGNvbnN0IGhvc3QgPSBhd2FpdCB0aGlzLl9kb21haW5DbGllbnQuZ2V0U2lnbmFsQ2xpZW50SG9zdChhY2NvdW50RGF0YS5yZWdpb25zKTtcbiAgICByZXR1cm4gbmV3IFNpZ25hbENsaWVudChhY2NvdW50RGF0YS5pZCwgaG9zdCwgdGhpcy5fZG9tYWluQ2xpZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSBzdG9wb3V0IHJlYXNvblxuICAgKiBAdHlwZWRlZiB7J2RheS1iYWxhbmNlLWRpZmZlcmVuY2UnIHwgJ2RhdGUtYmFsYW5jZS1kaWZmZXJlbmNlJyB8ICd3ZWVrLWJhbGFuY2UtZGlmZmVyZW5jZScgfFxuICAgKiAnd2Vlay10by1kYXRlLWJhbGFuY2UtZGlmZmVyZW5jZScgfCAnbW9udGgtYmFsYW5jZS1kaWZmZXJlbmNlJyB8ICdtb250aC10by1kYXRlLWJhbGFuY2UtZGlmZmVyZW5jZScgfFxuICAgKiAncXVhcnRlci1iYWxhbmNlLWRpZmZlcmVuY2UnIHwgJ3F1YXJ0ZXItdG8tZGF0ZS1iYWxhbmNlLWRpZmZlcmVuY2UnIHwgJ3llYXItYmFsYW5jZS1kaWZmZXJlbmNlJyB8XG4gICAqICd5ZWFyLXRvLWRhdGUtYmFsYW5jZS1kaWZmZXJlbmNlJyB8ICdsaWZldGltZS1iYWxhbmNlLWRpZmZlcmVuY2UnIHwgJ2RheS1iYWxhbmNlLW1pbnVzLWVxdWl0eScgfFxuICAgKiAnZGF0ZS1iYWxhbmNlLW1pbnVzLWVxdWl0eScgfCAnd2Vlay1iYWxhbmNlLW1pbnVzLWVxdWl0eScgfCAnd2Vlay10by1kYXRlLWJhbGFuY2UtbWludXMtZXF1aXR5JyB8XG4gICAqICdtb250aC1iYWxhbmNlLW1pbnVzLWVxdWl0eScgfCAnbW9udGgtdG8tZGF0ZS1iYWxhbmNlLW1pbnVzLWVxdWl0eScgfFxuICAgKiAncXVhcnRlci1iYWxhbmNlLW1pbnVzLWVxdWl0eScgfCAncXVhcnRlci10by1kYXRlLWJhbGFuY2UtbWludXMtZXF1aXR5JyB8ICd5ZWFyLWJhbGFuY2UtbWludXMtZXF1aXR5JyB8XG4gICAqICd5ZWFyLXRvLWRhdGUtYmFsYW5jZS1taW51cy1lcXVpdHknIHwgJ2xpZmV0aW1lLWJhbGFuY2UtbWludXMtZXF1aXR5JyB8XG4gICAqICdkYXktZXF1aXR5LWRpZmZlcmVuY2UnIHwgJ2RhdGUtZXF1aXR5LWRpZmZlcmVuY2UnIHwgJ3dlZWstZXF1aXR5LWRpZmZlcmVuY2UnIHxcbiAgICogJ3dlZWstdG8tZGF0ZS1lcXVpdHktZGlmZmVyZW5jZScgfCAnbW9udGgtZXF1aXR5LWRpZmZlcmVuY2UnIHxcbiAgICogJ21vbnRoLXRvLWRhdGUtZXF1aXR5LWRpZmZlcmVuY2UnIHwgJ3F1YXJ0ZXItZXF1aXR5LWRpZmZlcmVuY2UnIHwgJ3F1YXJ0ZXItdG8tZGF0ZS1lcXVpdHktZGlmZmVyZW5jZScgfFxuICAgKiAneWVhci1lcXVpdHktZGlmZmVyZW5jZScgfCAneWVhci10by1kYXRlLWVxdWl0eS1kaWZmZXJlbmNlJyB8XG4gICAqICdsaWZldGltZS1lcXVpdHktZGlmZmVyZW5jZSd9IENvcHlGYWN0b3J5U3RyYXRlZ3lTdG9wb3V0UmVhc29uXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb3B5RmFjdG9yeSBzdHJhdGVneSBzdG9wb3V0XG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5U3RyYXRlZ3lTdG9wb3V0XG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBzdWJzY3JpYmVySWQgc3Vic2NyaWJlciBpZFxuICAgKiBAcHJvcGVydHkge0NvcHlGYWN0b3J5U3RyYXRlZ3lJZEFuZE5hbWV9IHN0cmF0ZWd5IHN0cmF0ZWd5IHdoaWNoIHdhcyBzdG9wcGVkIG91dFxuICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IHBhcnRpYWwgZmxhZyBpbmRpY2F0aW5nIHRoYXQgc3RvcG91dCBpcyBwYXJ0aWFsXG4gICAqIEBwcm9wZXJ0eSB7Q29weUZhY3RvcnlTdHJhdGVneVN0b3BvdXRSZWFzb259IHJlYXNvbiBzdG9wb3V0IHJlYXNvblxuICAgKiBAcHJvcGVydHkge1N0cmluZ30gcmVhc29uRGVzY3JpcHRpb24gaHVtYW4tcmVhZGFibGUgZGVzY3JpcHRpb24gb2YgdGhlIHN0b3BvdXQgcmVhc29uXG4gICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gW2Nsb3NlUG9zaXRpb25zXSBmbGFnIGluZGljYXRpbmcgaWYgcG9zaXRpb25zIHNob3VsZCBiZSBjbG9zZWRcbiAgICogQHByb3BlcnR5IHtEYXRlfSBzdG9wcGVkQXQgdGltZSB0aGUgc3RyYXRlZ3kgd2FzIHN0b3BwZWQgYXRcbiAgICogQHByb3BlcnR5IHtEYXRlfSBzdG9wcGVkVGlsbCB0aW1lIHRoZSBzdHJhdGVneSBpcyBzdG9wcGVkIHRpbGxcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IHNlcXVlbmNlTnVtYmVyIHN0b3BvdXQgZXZlbnQgc2VxdWVuY2UgbnVtYmVyXG4gICAqL1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHN1YnNjcmliZXIgYWNjb3VudCBzdG9wb3V0cy4gU2VlXG4gICAqIGh0dHBzOi8vbWV0YWFwaS5jbG91ZC9kb2NzL2NvcHlmYWN0b3J5L3Jlc3RBcGkvYXBpL3RyYWRpbmcvZ2V0U3RvcE91dHMvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJzY3JpYmVySWQgc3Vic2NyaWJlciBpZFxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5PENvcHlGYWN0b3J5U3RyYXRlZ3lTdG9wb3V0Pj59IHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgd2l0aCBzdG9wb3V0cyBmb3VuZFxuICAgKi9cbiAgYXN5bmMgZ2V0U3RvcG91dHMoc3Vic2NyaWJlcklkKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFN0b3BvdXRzJyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9zdWJzY3JpYmVycy8ke3N1YnNjcmliZXJJZH0vc3RvcG91dHNgLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyBzdWJzY3JpcHRpb24gc3RvcG91dHMuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS90cmFkaW5nL3Jlc2V0U3Vic2NyaXB0aW9uU3RvcE91dHMvXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJzY3JpYmVySWQgc3Vic2NyaWJlciBpZFxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyYXRlZ3lJZCBzdHJhdGVneSBpZFxuICAgKiBAcGFyYW0ge0NvcHlGYWN0b3J5U3RyYXRlZ3lTdG9wb3V0UmVhc29ufSByZWFzb24gc3RvcG91dCByZWFzb24gdG8gcmVzZXRcbiAgICogeWVhcmx5LWVxdWl0eSwgbW9udGhseS1lcXVpdHksIGRhaWx5LWVxdWl0eVxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHdoZW4gdGhlIHN0b3BvdXRzIGFyZSByZXNldFxuICAgKi9cbiAgcmVzZXRTdWJzY3JpcHRpb25TdG9wb3V0cyhzdWJzY3JpYmVySWQsIHN0cmF0ZWd5SWQsIHJlYXNvbikge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdyZXNldFN1YnNjcmlwdGlvblN0b3BvdXRzJyk7XG4gICAgfVxuICAgIGNvbnN0IG9wdHMgPSB7XG4gICAgICB1cmw6IGAvdXNlcnMvY3VycmVudC9zdWJzY3JpYmVycy8ke3N1YnNjcmliZXJJZH0vc3Vic2NyaXB0aW9uLXN0cmF0ZWdpZXMvYCArXG4gICAgICAgIGAke3N0cmF0ZWd5SWR9L3N0b3BvdXRzLyR7cmVhc29ufS9yZXNldGAsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0cyBzdWJzY3JpYmVyIHN0b3BvdXRzLiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvdHJhZGluZy9yZXNldFN1YnNjcmliZXJTdG9wT3V0cy9cbiAgICogQHBhcmFtIHtTdHJpbmd9IHN1YnNjcmliZXJJZCBzdWJzY3JpYmVyIGlkXG4gICAqIEBwYXJhbSB7Q29weUZhY3RvcnlTdHJhdGVneVN0b3BvdXRSZWFzb259IHJlYXNvbiBzdG9wb3V0IHJlYXNvbiB0byByZXNldFxuICAgKiB5ZWFybHktZXF1aXR5LCBtb250aGx5LWVxdWl0eSwgZGFpbHktZXF1aXR5XG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgd2hlbiB0aGUgc3RvcG91dHMgYXJlIHJlc2V0XG4gICAqL1xuICByZXNldFN1YnNjcmliZXJTdG9wb3V0cyhzdWJzY3JpYmVySWQsIHJlYXNvbikge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdyZXNldFN1YnNjcmliZXJTdG9wb3V0cycpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvc3Vic2NyaWJlcnMvJHtzdWJzY3JpYmVySWR9L3N0b3BvdXRzLyR7cmVhc29ufS9yZXNldGAsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIHJldHVybiB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyYWRlIGNvcHlpbmcgdXNlciBsb2cgcmVjb3JkXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENvcHlGYWN0b3J5VXNlckxvZ01lc3NhZ2VcbiAgICogQHByb3BlcnR5IHtEYXRlfSB0aW1lIGxvZyByZWNvcmQgdGltZVxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3N5bWJvbF0gc3ltYm9sIHRyYWRlZFxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3N0cmF0ZWd5SWRdIGlkIG9mIHRoZSBzdHJhdGVneSBldmVudCByZWxhdGVzIHRvXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbc3RyYXRlZ3lOYW1lXSBuYW1lIG9mIHRoZSBzdHJhdGVneSBldmVudCByZWxhdGVzIHRvXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbcG9zaXRpb25JZF0gcG9zaXRpb24gaWQgZXZlbnQgcmVsYXRlcyB0b1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3NpZGVdIHNpZGUgb2YgdGhlIHRyYWRlIGV2ZW50IHJlbGF0ZXMgdG8uIE9uZSBvZiBidXksIHNlbGwsIGNsb3NlXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdHlwZV0gdHlwZSBvZiB0aGUgdHJhZGUgZXZlbnQgcmVsYXRlcyB0by4gT25lIG9mIG1hcmtldCwgbGltaXQsIHN0b3BcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IFtvcGVuUHJpY2VdIG9wZW4gcHJpY2UgZm9yIGxpbWl0IGFuZCBzdG9wIG9yZGVyc1xuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbGV2ZWwgbG9nIGxldmVsLiBPbmUgb2YgSU5GTywgV0FSTiwgRVJST1JcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IG1lc3NhZ2UgbG9nIG1lc3NhZ2VcbiAgICovXG5cbiAgLyoqXG4gICAqIFJldHVybnMgY29weSB0cmFkaW5nIHVzZXIgbG9nIGZvciBhbiBhY2NvdW50IGFuZCB0aW1lIHJhbmdlLiBTZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY29weWZhY3RvcnkvcmVzdEFwaS9hcGkvdHJhZGluZy9nZXRVc2VyTG9nL1xuICAgKiBAcGFyYW0ge1N0cmluZ30gc3Vic2NyaWJlcklkIHN1YnNjcmliZXIgaWRcbiAgICogQHBhcmFtIHtEYXRlfSBbc3RhcnRUaW1lXSB0aW1lIHRvIHN0YXJ0IGxvYWRpbmcgZGF0YSBmcm9tXG4gICAqIEBwYXJhbSB7RGF0ZX0gW2VuZFRpbWVdIHRpbWUgdG8gc3RvcCBsb2FkaW5nIGRhdGEgYXRcbiAgICogQHBhcmFtIHtTdHJpbmd9IFtzdHJhdGVneUlkXSBzdHJhdGVneSBpZCBmaWx0ZXJcbiAgICogQHBhcmFtIHtTdHJpbmd9IFtwb3NpdGlvbklkXSBwb3NpdGlvbiBpZCBmaWx0ZXJcbiAgICogQHBhcmFtIHsnREVCVUcnfCdJTkZPJ3wnV0FSTid8J0VSUk9SJ30gW2xldmVsXSBtaW5pbXVtIHNldmVyaXR5IGxldmVsXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbb2Zmc2V0XSBwYWdpbmF0aW9uIG9mZnNldC4gRGVmYXVsdCBpcyAwXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbbGltaXRdIHBhZ2luYXRpb24gbGltaXQuIERlZmF1bHQgaXMgMTAwMFxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5PENvcHlGYWN0b3J5VXNlckxvZ01lc3NhZ2U+Pn0gcHJvbWlzZSB3aGljaCByZXNvbHZlcyB3aXRoIGxvZyByZWNvcmRzIGZvdW5kXG4gICAqL1xuICBhc3luYyBnZXRVc2VyTG9nKHN1YnNjcmliZXJJZCwgc3RhcnRUaW1lLCBlbmRUaW1lLCBzdHJhdGVneUlkLCBwb3NpdGlvbklkLCBsZXZlbCwgb2Zmc2V0ID0gMCwgbGltaXQgPSAxMDAwKSB7XG4gICAgaWYgKHRoaXMuX2lzTm90Snd0VG9rZW4oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZU5vQWNjZXNzRXJyb3IoJ2dldFVzZXJMb2cnKTtcbiAgICB9XG4gICAgY29uc3Qgb3B0cyA9IHtcbiAgICAgIHVybDogYC91c2Vycy9jdXJyZW50L3N1YnNjcmliZXJzLyR7c3Vic2NyaWJlcklkfS91c2VyLWxvZ2AsXG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIHN0YXJ0VGltZSxcbiAgICAgICAgZW5kVGltZSxcbiAgICAgICAgc3RyYXRlZ3lJZCwgXG4gICAgICAgIHBvc2l0aW9uSWQsIFxuICAgICAgICBsZXZlbCxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgICBsaW1pdFxuICAgICAgfSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIGxldCByZXN1bHQgPSBhd2FpdCB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMsIHRydWUpO1xuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIHJlc3VsdC5tYXAociA9PiByLnRpbWUgPSBuZXcgRGF0ZShyLnRpbWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGV2ZW50IGxvZyBmb3IgQ29weUZhY3Rvcnkgc3RyYXRlZ3ksIHNvcnRlZCBpbiByZXZlcnNlIGNocm9ub2xvZ2ljYWwgb3JkZXIuIFNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jb3B5ZmFjdG9yeS9yZXN0QXBpL2FwaS90cmFkaW5nL2dldFN0cmF0ZWd5TG9nLyBcbiAgICogQHBhcmFtIHtTdHJpbmd9IHN0cmF0ZWd5SWQgc3RyYXRlZ3kgaWQgdG8gcmV0cmlldmUgbG9nIGZvclxuICAgKiBAcGFyYW0ge0RhdGV9IFtzdGFydFRpbWVdIHRpbWUgdG8gc3RhcnQgbG9hZGluZyBkYXRhIGZyb21cbiAgICogQHBhcmFtIHtEYXRlfSBbZW5kVGltZV0gdGltZSB0byBzdG9wIGxvYWRpbmcgZGF0YSBhdFxuICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bvc2l0aW9uSWRdIHBvc2l0aW9uIGlkIGZpbHRlclxuICAgKiBAcGFyYW0geydERUJVRyd8J0lORk8nfCdXQVJOJ3wnRVJST1InfSBbbGV2ZWxdIG1pbmltdW0gc2V2ZXJpdHkgbGV2ZWxcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtvZmZzZXRdIHBhZ2luYXRpb24gb2Zmc2V0LiBEZWZhdWx0IGlzIDBcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtsaW1pdF0gcGFnaW5hdGlvbiBsaW1pdC4gRGVmYXVsdCBpcyAxMDAwXG4gICAqIEByZXR1cm4ge1Byb21pc2U8QXJyYXk8Q29weUZhY3RvcnlVc2VyTG9nTWVzc2FnZT4+fSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHdpdGggbG9nIHJlY29yZHMgZm91bmRcbiAgICovXG4gIGFzeW5jIGdldFN0cmF0ZWd5TG9nKHN0cmF0ZWd5SWQsIHN0YXJ0VGltZSwgZW5kVGltZSwgcG9zaXRpb25JZCwgbGV2ZWwsIG9mZnNldCA9IDAsIGxpbWl0ID0gMTAwMCkge1xuICAgIGlmICh0aGlzLl9pc05vdEp3dFRva2VuKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9oYW5kbGVOb0FjY2Vzc0Vycm9yKCdnZXRTdHJhdGVneUxvZycpO1xuICAgIH1cbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgdXJsOiBgL3VzZXJzL2N1cnJlbnQvc3RyYXRlZ2llcy8ke3N0cmF0ZWd5SWR9L3VzZXItbG9nYCxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICBwYXJhbXM6IHtcbiAgICAgICAgc3RhcnRUaW1lLFxuICAgICAgICBlbmRUaW1lLFxuICAgICAgICBwb3NpdGlvbklkLFxuICAgICAgICBsZXZlbCxcbiAgICAgICAgb2Zmc2V0LFxuICAgICAgICBsaW1pdFxuICAgICAgfSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ2F1dGgtdG9rZW4nOiB0aGlzLl90b2tlblxuICAgICAgfSxcbiAgICAgIGpzb246IHRydWVcbiAgICB9O1xuICAgIGxldCByZXN1bHQgPSBhd2FpdCB0aGlzLl9kb21haW5DbGllbnQucmVxdWVzdENvcHlGYWN0b3J5KG9wdHMsIHRydWUpO1xuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIHJlc3VsdC5tYXAociA9PiByLnRpbWUgPSBuZXcgRGF0ZShyLnRpbWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgc3RvcG91dCBsaXN0ZW5lciBhbmQgY3JlYXRlcyBhIGpvYiB0byBtYWtlIHJlcXVlc3RzXG4gICAqIEBwYXJhbSB7U3RvcG91dExpc3RlbmVyfSBsaXN0ZW5lciBzdG9wb3V0IGxpc3RlbmVyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbYWNjb3VudElkXSBhY2NvdW50IGlkXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbc3RyYXRlZ3lJZF0gc3RyYXRlZ3kgaWRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IFtzZXF1ZW5jZU51bWJlcl0gc2VxdWVuY2UgbnVtYmVyXG4gICAqIEByZXR1cm4ge1N0cmluZ30gbGlzdGVuZXIgaWRcbiAgICovXG4gIGFkZFN0b3BvdXRMaXN0ZW5lcihsaXN0ZW5lciwgYWNjb3VudElkLCBzdHJhdGVneUlkLCBzZXF1ZW5jZU51bWJlcikge1xuICAgIHJldHVybiB0aGlzLl9zdG9wb3V0TGlzdGVuZXJNYW5hZ2VyLmFkZFN0b3BvdXRMaXN0ZW5lcihsaXN0ZW5lciwgYWNjb3VudElkLCBzdHJhdGVneUlkLCBzZXF1ZW5jZU51bWJlcik7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBzdG9wb3V0IGxpc3RlbmVyIGFuZCBjYW5jZWxzIHRoZSBldmVudCBzdHJlYW1cbiAgICogQHBhcmFtIHtTdHJpbmd9IGxpc3RlbmVySWQgc3RvcG91dCBsaXN0ZW5lciBpZFxuICAgKi9cbiAgcmVtb3ZlU3RvcG91dExpc3RlbmVyKGxpc3RlbmVySWQpIHtcbiAgICB0aGlzLl9zdG9wb3V0TGlzdGVuZXJNYW5hZ2VyLnJlbW92ZVN0b3BvdXRMaXN0ZW5lcihsaXN0ZW5lcklkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgc3RyYXRlZ3kgbG9nIGxpc3RlbmVyIGFuZCBjcmVhdGVzIGEgam9iIHRvIG1ha2UgcmVxdWVzdHNcbiAgICogQHBhcmFtIHtVc2VyTG9nTGlzdGVuZXJ9IGxpc3RlbmVyIHVzZXIgbG9nIGxpc3RlbmVyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJhdGVneUlkIHN0cmF0ZWd5IGlkXG4gICAqIEBwYXJhbSB7RGF0ZX0gW3N0YXJ0VGltZV0gbG9nIHNlYXJjaCBzdGFydCB0aW1lXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBbcG9zaXRpb25JZF0gcG9zaXRpb24gaWQgZmlsdGVyXG4gICAqIEBwYXJhbSB7J0RFQlVHJ3wnSU5GTyd8J1dBUk4nfCdFUlJPUid9IFtsZXZlbF0gbWluaW11bSBzZXZlcml0eSBsZXZlbFxuICAgKiBAcGFyYW0ge051bWJlcn0gW2xpbWl0XSBsb2cgcGFnaW5hdGlvbiBsaW1pdFxuICAgKiBAcmV0dXJuIHtTdHJpbmd9IGxpc3RlbmVyIGlkXG4gICAqL1xuICBhZGRTdHJhdGVneUxvZ0xpc3RlbmVyKGxpc3RlbmVyLCBzdHJhdGVneUlkLCBzdGFydFRpbWUsIHBvc2l0aW9uSWQsIGxldmVsLCBsaW1pdCkge1xuICAgIHJldHVybiB0aGlzLl91c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLmFkZFN0cmF0ZWd5TG9nTGlzdGVuZXIoXG4gICAgICBsaXN0ZW5lciwgXG4gICAgICBzdHJhdGVneUlkLCBcbiAgICAgIHN0YXJ0VGltZSwgXG4gICAgICBwb3NpdGlvbklkLCBcbiAgICAgIGxldmVsLCBcbiAgICAgIGxpbWl0XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIHN0cmF0ZWd5IGxvZyBsaXN0ZW5lciBhbmQgY2FuY2VscyB0aGUgZXZlbnQgc3RyZWFtXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBsaXN0ZW5lcklkIHN0cmF0ZWd5IGxvZyBsaXN0ZW5lciBpZFxuICAgKi9cbiAgcmVtb3ZlU3RyYXRlZ3lMb2dMaXN0ZW5lcihsaXN0ZW5lcklkKSB7XG4gICAgdGhpcy5fdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5yZW1vdmVTdHJhdGVneUxvZ0xpc3RlbmVyKGxpc3RlbmVySWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBzdWJzY3JpYmVyIGxvZyBsaXN0ZW5lciBhbmQgY3JlYXRlcyBhIGpvYiB0byBtYWtlIHJlcXVlc3RzXG4gICAqIEBwYXJhbSB7VXNlckxvZ0xpc3RlbmVyfSBsaXN0ZW5lciB1c2VyIGxvZyBsaXN0ZW5lclxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3Vic2NyaWJlcklkIHN1YnNjcmliZXIgaWRcbiAgICogQHBhcmFtIHtEYXRlfSBbc3RhcnRUaW1lXSBsb2cgc2VhcmNoIHN0YXJ0IHRpbWVcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtzdHJhdGVneUlkXSBzdHJhdGVneSBpZCBmaWx0ZXJcbiAgICogQHBhcmFtIHtzdHJpbmd9IFtwb3NpdGlvbklkXSBwb3NpdGlvbiBpZCBmaWx0ZXJcbiAgICogQHBhcmFtIHsnREVCVUcnfCdJTkZPJ3wnV0FSTid8J0VSUk9SJ30gW2xldmVsXSBtaW5pbXVtIHNldmVyaXR5IGxldmVsXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBbbGltaXRdIGxvZyBwYWdpbmF0aW9uIGxpbWl0XG4gICAqIEByZXR1cm4ge1N0cmluZ30gbGlzdGVuZXIgaWRcbiAgICovXG4gIGFkZFN1YnNjcmliZXJMb2dMaXN0ZW5lcihsaXN0ZW5lciwgc3Vic2NyaWJlcklkLCBzdGFydFRpbWUsIHN0cmF0ZWd5SWQsIHBvc2l0aW9uSWQsIGxldmVsLCBsaW1pdCkge1xuICAgIHJldHVybiB0aGlzLl91c2VyTG9nTGlzdGVuZXJNYW5hZ2VyLmFkZFN1YnNjcmliZXJMb2dMaXN0ZW5lcihcbiAgICAgIGxpc3RlbmVyLCBcbiAgICAgIHN1YnNjcmliZXJJZCwgXG4gICAgICBzdGFydFRpbWUsIFxuICAgICAgc3RyYXRlZ3lJZCwgXG4gICAgICBwb3NpdGlvbklkLCBcbiAgICAgIGxldmVsLCBcbiAgICAgIGxpbWl0XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIHN1YnNjcmliZXIgbG9nIGxpc3RlbmVyIGFuZCBjYW5jZWxzIHRoZSBldmVudCBzdHJlYW1cbiAgICogQHBhcmFtIHtTdHJpbmd9IGxpc3RlbmVySWQgc3Vic2NyaWJlciBsb2cgbGlzdGVuZXIgaWRcbiAgICovXG4gIHJlbW92ZVN1YnNjcmliZXJMb2dMaXN0ZW5lcihsaXN0ZW5lcklkKSB7XG4gICAgdGhpcy5fdXNlckxvZ0xpc3RlbmVyTWFuYWdlci5yZW1vdmVTdWJzY3JpYmVyTG9nTGlzdGVuZXIobGlzdGVuZXJJZCk7XG4gIH1cblxufVxuIl0sIm5hbWVzIjpbIk1ldGFBcGlDbGllbnQiLCJTaWduYWxDbGllbnQiLCJTdG9wb3V0TGlzdGVuZXJNYW5hZ2VyIiwiVXNlckxvZ0xpc3RlbmVyTWFuYWdlciIsIlRyYWRpbmdDbGllbnQiLCJyZXN5bmNocm9uaXplIiwiYWNjb3VudElkIiwic3RyYXRlZ3lJZHMiLCJwb3NpdGlvbklkcyIsIl9pc05vdEp3dFRva2VuIiwiX2hhbmRsZU5vQWNjZXNzRXJyb3IiLCJvcHRzIiwidXJsIiwibWV0aG9kIiwiaGVhZGVycyIsIl90b2tlbiIsInBhcmFtcyIsInN0cmF0ZWd5SWQiLCJwb3NpdGlvbklkIiwianNvbiIsIl9kb21haW5DbGllbnQiLCJyZXF1ZXN0Q29weUZhY3RvcnkiLCJnZXRTaWduYWxDbGllbnQiLCJhY2NvdW50RGF0YSIsImdldEFjY291bnRJbmZvIiwiaG9zdCIsImdldFNpZ25hbENsaWVudEhvc3QiLCJyZWdpb25zIiwiaWQiLCJnZXRTdG9wb3V0cyIsInN1YnNjcmliZXJJZCIsInJlc2V0U3Vic2NyaXB0aW9uU3RvcG91dHMiLCJyZWFzb24iLCJyZXNldFN1YnNjcmliZXJTdG9wb3V0cyIsImdldFVzZXJMb2ciLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwibGV2ZWwiLCJvZmZzZXQiLCJsaW1pdCIsInJlc3VsdCIsIm1hcCIsInIiLCJ0aW1lIiwiRGF0ZSIsImdldFN0cmF0ZWd5TG9nIiwiYWRkU3RvcG91dExpc3RlbmVyIiwibGlzdGVuZXIiLCJzZXF1ZW5jZU51bWJlciIsIl9zdG9wb3V0TGlzdGVuZXJNYW5hZ2VyIiwicmVtb3ZlU3RvcG91dExpc3RlbmVyIiwibGlzdGVuZXJJZCIsImFkZFN0cmF0ZWd5TG9nTGlzdGVuZXIiLCJfdXNlckxvZ0xpc3RlbmVyTWFuYWdlciIsInJlbW92ZVN0cmF0ZWd5TG9nTGlzdGVuZXIiLCJhZGRTdWJzY3JpYmVyTG9nTGlzdGVuZXIiLCJyZW1vdmVTdWJzY3JpYmVyTG9nTGlzdGVuZXIiLCJjb25zdHJ1Y3RvciIsImRvbWFpbkNsaWVudCJdLCJtYXBwaW5ncyI6IkFBQUE7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