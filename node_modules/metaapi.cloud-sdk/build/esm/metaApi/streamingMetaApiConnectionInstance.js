'use strict';
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
    try {
        var info = gen[key](arg);
        var value = info.value;
    } catch (error) {
        reject(error);
        return;
    }
    if (info.done) {
        resolve(value);
    } else {
        Promise.resolve(value).then(_next, _throw);
    }
}
function _async_to_generator(fn) {
    return function() {
        var self = this, args = arguments;
        return new Promise(function(resolve, reject) {
            var gen = fn.apply(self, args);
            function _next(value) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
            }
            function _throw(err) {
                asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
            }
            _next(undefined);
        });
    };
}
import TerminalState from './terminalState';
import ConnectionHealthMonitor from './connectionHealthMonitor';
import LoggerManager from '../logger';
import MetaApiConnectionInstance from './metaApiConnectionInstance';
let StreamingMetaApiConnectionInstance = class StreamingMetaApiConnectionInstance extends MetaApiConnectionInstance {
    /**
   * Opens the connection. Can only be called the first time, next calls will be ignored.
   * @return {Promise} promise resolving when the connection is opened
   */ connect() {
        var _this = this;
        return _async_to_generator(function*() {
            if (!_this._opened) {
                _this._opened = true;
                try {
                    yield _this._metaApiConnection.connect(_this.instanceId);
                } catch (err) {
                    yield _this.close();
                    throw err;
                }
            }
        })();
    }
    /**
   * Clears the order and transaction history of a specified application and removes application
   * @return {Promise} promise resolving when the history is cleared and application is removed
   */ removeApplication() {
        return this._metaApiConnection.removeApplication();
    }
    /**
   * Subscribes on market data of specified symbol (see
   * https://metaapi.cloud/docs/client/websocket/marketDataStreaming/subscribeToMarketData/).
   * @param {String} symbol symbol (e.g. currency pair or an index)
   * @param {Array<MarketDataSubscription>} subscriptions array of market data subscription to create or update. Please
   * note that this feature is not fully implemented on server-side yet
   * @param {number} [timeoutInSeconds] timeout to wait for prices in seconds, default is 30
   * @param {boolean} [waitForQuote] if set to false, the method will resolve without waiting for the first quote to
   * arrive. Default is to wait for quote if quotes subscription is requested.
   * @returns {Promise} promise which resolves when subscription request was processed
   */ subscribeToMarketData(symbol, subscriptions, timeoutInSeconds, waitForQuote = true) {
        var _this = this;
        return _async_to_generator(function*() {
            _this._checkIsConnectionActive();
            return _this._metaApiConnection.subscribeToMarketData(symbol, subscriptions, timeoutInSeconds, waitForQuote);
        })();
    }
    /**
   * Unsubscribes from market data of specified symbol (see
   * https://metaapi.cloud/docs/client/websocket/marketDataStreaming/unsubscribeFromMarketData/).
   * @param {String} symbol symbol (e.g. currency pair or an index)
   * @param {Array<MarketDataUnsubscription>} subscriptions array of subscriptions to cancel
   * @returns {Promise} promise which resolves when unsubscription request was processed
   */ unsubscribeFromMarketData(symbol, subscriptions) {
        this._checkIsConnectionActive();
        return this._metaApiConnection.unsubscribeFromMarketData(symbol, subscriptions);
    }
    /**
   * Returns list of the symbols connection is subscribed to
   * @returns {Array<String>} list of the symbols connection is subscribed to
   */ get subscribedSymbols() {
        return this._metaApiConnection.subscribedSymbols;
    }
    /**
   * Returns subscriptions for a symbol
   * @param {string} symbol symbol to retrieve subscriptions for
   * @returns {Array<MarketDataSubscription>} list of market data subscriptions for the symbol
   */ subscriptions(symbol) {
        return this._metaApiConnection.subscriptions(symbol);
    }
    /**
   * Sends client uptime stats to the server.
   * @param {Object} uptime uptime statistics to send to the server
   * @returns {Promise} promise which resolves when uptime statistics is submitted
   */ saveUptime(uptime) {
        this._checkIsConnectionActive();
        return this._websocketClient.saveUptime(this._metaApiConnection.account.id, uptime);
    }
    /**
   * Returns local copy of terminal state
   * @returns {TerminalState} local copy of terminal state
   */ get terminalState() {
        return this._metaApiConnection.terminalState;
    }
    /**
   * Returns local history storage
   * @returns {HistoryStorage} local history storage
   */ get historyStorage() {
        return this._metaApiConnection.historyStorage;
    }
    /**
   * Adds synchronization listener
   * @param {SynchronizationListener} listener synchronization listener to add
   */ addSynchronizationListener(listener) {
        this._synchronizationListeners.push(listener);
        this._websocketClient.addSynchronizationListener(this._metaApiConnection.account.id, listener);
    }
    /**
   * Removes synchronization listener for specific account
   * @param {SynchronizationListener} listener synchronization listener to remove
   */ removeSynchronizationListener(listener) {
        this._synchronizationListeners = this._synchronizationListeners.filter((l)=>l !== listener);
        this._websocketClient.removeSynchronizationListener(this._metaApiConnection.account.id, listener);
    }
    /**
   * @typedef {Object} SynchronizationOptions
   * @property {String} [applicationPattern] application regular expression pattern, default is .*
   * @property {String} [synchronizationId] synchronization id, last synchronization request id will be used by
   * default
   * @property {Number} [instanceIndex] index of an account instance to ensure synchronization on, default is to wait
   * for the first instance to synchronize
   * @property {Number} [timeoutInSeconds] wait timeout in seconds, default is 5m
   * @property {Number} [intervalInMilliseconds] interval between account reloads while waiting for a change, default is 1s
   */ /**
   * Waits until synchronization to MetaTrader terminal is completed
   * @param {SynchronizationOptions} opts synchronization options
   * @return {Promise} promise which resolves when synchronization to MetaTrader terminal is completed
   * @throws {TimeoutError} if application failed to synchronize with the teminal within timeout allowed
   */ // eslint-disable-next-line complexity
    waitSynchronized(opts) {
        var _this = this;
        return _async_to_generator(function*() {
            _this._checkIsConnectionActive();
            return _this._metaApiConnection.waitSynchronized(opts);
        })();
    }
    /**
   * Queues an event for processing among other synchronization events within same account
   * @param {String} name event label name
   * @param {Function} callable async or regular function to execute
   */ queueEvent(name, callable) {
        this._websocketClient.queueEvent(this._metaApiConnection.account.id, name, callable);
    }
    /**
   * Closes the connection. The instance of the class should no longer be used after this method is invoked.
   */ close() {
        var _this = this;
        return _async_to_generator(function*() {
            if (!_this._closed) {
                for (let listener of _this._synchronizationListeners){
                    _this._websocketClient.removeSynchronizationListener(_this._metaApiConnection.account.id, listener);
                }
                _this._closed = true;
                yield _this._metaApiConnection.close(_this.instanceId);
            }
        })();
    }
    /**
   * Returns synchronization status
   * @return {boolean} synchronization status
   */ get synchronized() {
        return this._metaApiConnection.synchronized;
    }
    /**
   * Returns MetaApi account
   * @return {MetatraderAccount} MetaApi account
   */ get account() {
        return this._metaApiConnection.account;
    }
    /**
   * Returns connection health monitor instance
   * @return {ConnectionHealthMonitor} connection health monitor instance
   */ get healthMonitor() {
        return this._metaApiConnection.healthMonitor;
    }
    /**
   * Constructs MetaApi MetaTrader streaming Api connection instance
   * @param {MetaApiWebsocketClient} websocketClient MetaApi websocket client
   * @param {StreamingMetaApiConnection} metaApiConnection streaming MetaApi connection
   */ constructor(websocketClient, metaApiConnection){
        super(websocketClient, metaApiConnection);
        this._metaApiConnection = metaApiConnection;
        this._synchronizationListeners = [];
        this._logger = LoggerManager.getLogger('StreamingMetaApiConnectionInstance');
    }
};
/**
 * Exposes MetaApi MetaTrader streaming API connection instance to consumers
 */ export { StreamingMetaApiConnectionInstance as default };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjxhbm9uPiJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmltcG9ydCBUZXJtaW5hbFN0YXRlIGZyb20gJy4vdGVybWluYWxTdGF0ZSc7XG5pbXBvcnQgQ29ubmVjdGlvbkhlYWx0aE1vbml0b3IgZnJvbSAnLi9jb25uZWN0aW9uSGVhbHRoTW9uaXRvcic7XG5pbXBvcnQgTG9nZ2VyTWFuYWdlciBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IE1ldGFBcGlDb25uZWN0aW9uSW5zdGFuY2UgZnJvbSAnLi9tZXRhQXBpQ29ubmVjdGlvbkluc3RhbmNlJztcblxuLyoqXG4gKiBFeHBvc2VzIE1ldGFBcGkgTWV0YVRyYWRlciBzdHJlYW1pbmcgQVBJIGNvbm5lY3Rpb24gaW5zdGFuY2UgdG8gY29uc3VtZXJzXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0cmVhbWluZ01ldGFBcGlDb25uZWN0aW9uSW5zdGFuY2UgZXh0ZW5kcyBNZXRhQXBpQ29ubmVjdGlvbkluc3RhbmNlIHtcblxuICAvKipcbiAgICogQ29uc3RydWN0cyBNZXRhQXBpIE1ldGFUcmFkZXIgc3RyZWFtaW5nIEFwaSBjb25uZWN0aW9uIGluc3RhbmNlXG4gICAqIEBwYXJhbSB7TWV0YUFwaVdlYnNvY2tldENsaWVudH0gd2Vic29ja2V0Q2xpZW50IE1ldGFBcGkgd2Vic29ja2V0IGNsaWVudFxuICAgKiBAcGFyYW0ge1N0cmVhbWluZ01ldGFBcGlDb25uZWN0aW9ufSBtZXRhQXBpQ29ubmVjdGlvbiBzdHJlYW1pbmcgTWV0YUFwaSBjb25uZWN0aW9uXG4gICAqL1xuICBjb25zdHJ1Y3Rvcih3ZWJzb2NrZXRDbGllbnQsIG1ldGFBcGlDb25uZWN0aW9uKSB7XG4gICAgc3VwZXIod2Vic29ja2V0Q2xpZW50LCBtZXRhQXBpQ29ubmVjdGlvbik7XG4gICAgdGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24gPSBtZXRhQXBpQ29ubmVjdGlvbjtcbiAgICB0aGlzLl9zeW5jaHJvbml6YXRpb25MaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLl9sb2dnZXIgPSBMb2dnZXJNYW5hZ2VyLmdldExvZ2dlcignU3RyZWFtaW5nTWV0YUFwaUNvbm5lY3Rpb25JbnN0YW5jZScpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW5zIHRoZSBjb25uZWN0aW9uLiBDYW4gb25seSBiZSBjYWxsZWQgdGhlIGZpcnN0IHRpbWUsIG5leHQgY2FsbHMgd2lsbCBiZSBpZ25vcmVkLlxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSBwcm9taXNlIHJlc29sdmluZyB3aGVuIHRoZSBjb25uZWN0aW9uIGlzIG9wZW5lZFxuICAgKi9cbiAgYXN5bmMgY29ubmVjdCgpIHtcbiAgICBpZighdGhpcy5fb3BlbmVkKSB7XG4gICAgICB0aGlzLl9vcGVuZWQgPSB0cnVlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24uY29ubmVjdCh0aGlzLmluc3RhbmNlSWQpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY2xvc2UoKTtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgdGhlIG9yZGVyIGFuZCB0cmFuc2FjdGlvbiBoaXN0b3J5IG9mIGEgc3BlY2lmaWVkIGFwcGxpY2F0aW9uIGFuZCByZW1vdmVzIGFwcGxpY2F0aW9uXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIGhpc3RvcnkgaXMgY2xlYXJlZCBhbmQgYXBwbGljYXRpb24gaXMgcmVtb3ZlZFxuICAgKi9cbiAgcmVtb3ZlQXBwbGljYXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX21ldGFBcGlDb25uZWN0aW9uLnJlbW92ZUFwcGxpY2F0aW9uKCk7XG4gIH1cblxuICAvKipcbiAgICogU3Vic2NyaWJlcyBvbiBtYXJrZXQgZGF0YSBvZiBzcGVjaWZpZWQgc3ltYm9sIChzZWVcbiAgICogaHR0cHM6Ly9tZXRhYXBpLmNsb3VkL2RvY3MvY2xpZW50L3dlYnNvY2tldC9tYXJrZXREYXRhU3RyZWFtaW5nL3N1YnNjcmliZVRvTWFya2V0RGF0YS8pLlxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3ltYm9sIHN5bWJvbCAoZS5nLiBjdXJyZW5jeSBwYWlyIG9yIGFuIGluZGV4KVxuICAgKiBAcGFyYW0ge0FycmF5PE1hcmtldERhdGFTdWJzY3JpcHRpb24+fSBzdWJzY3JpcHRpb25zIGFycmF5IG9mIG1hcmtldCBkYXRhIHN1YnNjcmlwdGlvbiB0byBjcmVhdGUgb3IgdXBkYXRlLiBQbGVhc2VcbiAgICogbm90ZSB0aGF0IHRoaXMgZmVhdHVyZSBpcyBub3QgZnVsbHkgaW1wbGVtZW50ZWQgb24gc2VydmVyLXNpZGUgeWV0XG4gICAqIEBwYXJhbSB7bnVtYmVyfSBbdGltZW91dEluU2Vjb25kc10gdGltZW91dCB0byB3YWl0IGZvciBwcmljZXMgaW4gc2Vjb25kcywgZGVmYXVsdCBpcyAzMFxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IFt3YWl0Rm9yUXVvdGVdIGlmIHNldCB0byBmYWxzZSwgdGhlIG1ldGhvZCB3aWxsIHJlc29sdmUgd2l0aG91dCB3YWl0aW5nIGZvciB0aGUgZmlyc3QgcXVvdGUgdG9cbiAgICogYXJyaXZlLiBEZWZhdWx0IGlzIHRvIHdhaXQgZm9yIHF1b3RlIGlmIHF1b3RlcyBzdWJzY3JpcHRpb24gaXMgcmVxdWVzdGVkLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gcHJvbWlzZSB3aGljaCByZXNvbHZlcyB3aGVuIHN1YnNjcmlwdGlvbiByZXF1ZXN0IHdhcyBwcm9jZXNzZWRcbiAgICovXG4gIGFzeW5jIHN1YnNjcmliZVRvTWFya2V0RGF0YShzeW1ib2wsIHN1YnNjcmlwdGlvbnMsIHRpbWVvdXRJblNlY29uZHMsIHdhaXRGb3JRdW90ZSA9IHRydWUpIHtcbiAgICB0aGlzLl9jaGVja0lzQ29ubmVjdGlvbkFjdGl2ZSgpO1xuICAgIHJldHVybiB0aGlzLl9tZXRhQXBpQ29ubmVjdGlvbi5zdWJzY3JpYmVUb01hcmtldERhdGEoc3ltYm9sLCBzdWJzY3JpcHRpb25zLCB0aW1lb3V0SW5TZWNvbmRzLCB3YWl0Rm9yUXVvdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuc3Vic2NyaWJlcyBmcm9tIG1hcmtldCBkYXRhIG9mIHNwZWNpZmllZCBzeW1ib2wgKHNlZVxuICAgKiBodHRwczovL21ldGFhcGkuY2xvdWQvZG9jcy9jbGllbnQvd2Vic29ja2V0L21hcmtldERhdGFTdHJlYW1pbmcvdW5zdWJzY3JpYmVGcm9tTWFya2V0RGF0YS8pLlxuICAgKiBAcGFyYW0ge1N0cmluZ30gc3ltYm9sIHN5bWJvbCAoZS5nLiBjdXJyZW5jeSBwYWlyIG9yIGFuIGluZGV4KVxuICAgKiBAcGFyYW0ge0FycmF5PE1hcmtldERhdGFVbnN1YnNjcmlwdGlvbj59IHN1YnNjcmlwdGlvbnMgYXJyYXkgb2Ygc3Vic2NyaXB0aW9ucyB0byBjYW5jZWxcbiAgICogQHJldHVybnMge1Byb21pc2V9IHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgd2hlbiB1bnN1YnNjcmlwdGlvbiByZXF1ZXN0IHdhcyBwcm9jZXNzZWRcbiAgICovXG4gIHVuc3Vic2NyaWJlRnJvbU1hcmtldERhdGEoc3ltYm9sLCBzdWJzY3JpcHRpb25zKSB7XG4gICAgdGhpcy5fY2hlY2tJc0Nvbm5lY3Rpb25BY3RpdmUoKTtcbiAgICByZXR1cm4gdGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24udW5zdWJzY3JpYmVGcm9tTWFya2V0RGF0YShzeW1ib2wsIHN1YnNjcmlwdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgbGlzdCBvZiB0aGUgc3ltYm9scyBjb25uZWN0aW9uIGlzIHN1YnNjcmliZWQgdG9cbiAgICogQHJldHVybnMge0FycmF5PFN0cmluZz59IGxpc3Qgb2YgdGhlIHN5bWJvbHMgY29ubmVjdGlvbiBpcyBzdWJzY3JpYmVkIHRvXG4gICAqL1xuICBnZXQgc3Vic2NyaWJlZFN5bWJvbHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21ldGFBcGlDb25uZWN0aW9uLnN1YnNjcmliZWRTeW1ib2xzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgc3Vic2NyaXB0aW9ucyBmb3IgYSBzeW1ib2xcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN5bWJvbCBzeW1ib2wgdG8gcmV0cmlldmUgc3Vic2NyaXB0aW9ucyBmb3JcbiAgICogQHJldHVybnMge0FycmF5PE1hcmtldERhdGFTdWJzY3JpcHRpb24+fSBsaXN0IG9mIG1hcmtldCBkYXRhIHN1YnNjcmlwdGlvbnMgZm9yIHRoZSBzeW1ib2xcbiAgICovXG4gIHN1YnNjcmlwdGlvbnMoc3ltYm9sKSB7XG4gICAgcmV0dXJuIHRoaXMuX21ldGFBcGlDb25uZWN0aW9uLnN1YnNjcmlwdGlvbnMoc3ltYm9sKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kcyBjbGllbnQgdXB0aW1lIHN0YXRzIHRvIHRoZSBzZXJ2ZXIuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1cHRpbWUgdXB0aW1lIHN0YXRpc3RpY3MgdG8gc2VuZCB0byB0aGUgc2VydmVyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBwcm9taXNlIHdoaWNoIHJlc29sdmVzIHdoZW4gdXB0aW1lIHN0YXRpc3RpY3MgaXMgc3VibWl0dGVkXG4gICAqL1xuICBzYXZlVXB0aW1lKHVwdGltZSkge1xuICAgIHRoaXMuX2NoZWNrSXNDb25uZWN0aW9uQWN0aXZlKCk7XG4gICAgcmV0dXJuIHRoaXMuX3dlYnNvY2tldENsaWVudC5zYXZlVXB0aW1lKHRoaXMuX21ldGFBcGlDb25uZWN0aW9uLmFjY291bnQuaWQsIHVwdGltZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBsb2NhbCBjb3B5IG9mIHRlcm1pbmFsIHN0YXRlXG4gICAqIEByZXR1cm5zIHtUZXJtaW5hbFN0YXRlfSBsb2NhbCBjb3B5IG9mIHRlcm1pbmFsIHN0YXRlXG4gICAqL1xuICBnZXQgdGVybWluYWxTdGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24udGVybWluYWxTdGF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGxvY2FsIGhpc3Rvcnkgc3RvcmFnZVxuICAgKiBAcmV0dXJucyB7SGlzdG9yeVN0b3JhZ2V9IGxvY2FsIGhpc3Rvcnkgc3RvcmFnZVxuICAgKi9cbiAgZ2V0IGhpc3RvcnlTdG9yYWdlKCkge1xuICAgIHJldHVybiB0aGlzLl9tZXRhQXBpQ29ubmVjdGlvbi5oaXN0b3J5U3RvcmFnZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHN5bmNocm9uaXphdGlvbiBsaXN0ZW5lclxuICAgKiBAcGFyYW0ge1N5bmNocm9uaXphdGlvbkxpc3RlbmVyfSBsaXN0ZW5lciBzeW5jaHJvbml6YXRpb24gbGlzdGVuZXIgdG8gYWRkXG4gICAqL1xuICBhZGRTeW5jaHJvbml6YXRpb25MaXN0ZW5lcihsaXN0ZW5lcikge1xuICAgIHRoaXMuX3N5bmNocm9uaXphdGlvbkxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcbiAgICB0aGlzLl93ZWJzb2NrZXRDbGllbnQuYWRkU3luY2hyb25pemF0aW9uTGlzdGVuZXIodGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24uYWNjb3VudC5pZCwgbGlzdGVuZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgc3luY2hyb25pemF0aW9uIGxpc3RlbmVyIGZvciBzcGVjaWZpYyBhY2NvdW50XG4gICAqIEBwYXJhbSB7U3luY2hyb25pemF0aW9uTGlzdGVuZXJ9IGxpc3RlbmVyIHN5bmNocm9uaXphdGlvbiBsaXN0ZW5lciB0byByZW1vdmVcbiAgICovXG4gIHJlbW92ZVN5bmNocm9uaXphdGlvbkxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gICAgdGhpcy5fc3luY2hyb25pemF0aW9uTGlzdGVuZXJzID0gdGhpcy5fc3luY2hyb25pemF0aW9uTGlzdGVuZXJzLmZpbHRlcihsID0+IGwgIT09IGxpc3RlbmVyKTtcbiAgICB0aGlzLl93ZWJzb2NrZXRDbGllbnQucmVtb3ZlU3luY2hyb25pemF0aW9uTGlzdGVuZXIodGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24uYWNjb3VudC5pZCwgbGlzdGVuZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IFN5bmNocm9uaXphdGlvbk9wdGlvbnNcbiAgICogQHByb3BlcnR5IHtTdHJpbmd9IFthcHBsaWNhdGlvblBhdHRlcm5dIGFwcGxpY2F0aW9uIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJuLCBkZWZhdWx0IGlzIC4qXG4gICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSBbc3luY2hyb25pemF0aW9uSWRdIHN5bmNocm9uaXphdGlvbiBpZCwgbGFzdCBzeW5jaHJvbml6YXRpb24gcmVxdWVzdCBpZCB3aWxsIGJlIHVzZWQgYnlcbiAgICogZGVmYXVsdFxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW2luc3RhbmNlSW5kZXhdIGluZGV4IG9mIGFuIGFjY291bnQgaW5zdGFuY2UgdG8gZW5zdXJlIHN5bmNocm9uaXphdGlvbiBvbiwgZGVmYXVsdCBpcyB0byB3YWl0XG4gICAqIGZvciB0aGUgZmlyc3QgaW5zdGFuY2UgdG8gc3luY2hyb25pemVcbiAgICogQHByb3BlcnR5IHtOdW1iZXJ9IFt0aW1lb3V0SW5TZWNvbmRzXSB3YWl0IHRpbWVvdXQgaW4gc2Vjb25kcywgZGVmYXVsdCBpcyA1bVxuICAgKiBAcHJvcGVydHkge051bWJlcn0gW2ludGVydmFsSW5NaWxsaXNlY29uZHNdIGludGVydmFsIGJldHdlZW4gYWNjb3VudCByZWxvYWRzIHdoaWxlIHdhaXRpbmcgZm9yIGEgY2hhbmdlLCBkZWZhdWx0IGlzIDFzXG4gICAqL1xuXG4gIC8qKlxuICAgKiBXYWl0cyB1bnRpbCBzeW5jaHJvbml6YXRpb24gdG8gTWV0YVRyYWRlciB0ZXJtaW5hbCBpcyBjb21wbGV0ZWRcbiAgICogQHBhcmFtIHtTeW5jaHJvbml6YXRpb25PcHRpb25zfSBvcHRzIHN5bmNocm9uaXphdGlvbiBvcHRpb25zXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IHByb21pc2Ugd2hpY2ggcmVzb2x2ZXMgd2hlbiBzeW5jaHJvbml6YXRpb24gdG8gTWV0YVRyYWRlciB0ZXJtaW5hbCBpcyBjb21wbGV0ZWRcbiAgICogQHRocm93cyB7VGltZW91dEVycm9yfSBpZiBhcHBsaWNhdGlvbiBmYWlsZWQgdG8gc3luY2hyb25pemUgd2l0aCB0aGUgdGVtaW5hbCB3aXRoaW4gdGltZW91dCBhbGxvd2VkXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGxleGl0eVxuICBhc3luYyB3YWl0U3luY2hyb25pemVkKG9wdHMpIHtcbiAgICB0aGlzLl9jaGVja0lzQ29ubmVjdGlvbkFjdGl2ZSgpO1xuICAgIHJldHVybiB0aGlzLl9tZXRhQXBpQ29ubmVjdGlvbi53YWl0U3luY2hyb25pemVkKG9wdHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFF1ZXVlcyBhbiBldmVudCBmb3IgcHJvY2Vzc2luZyBhbW9uZyBvdGhlciBzeW5jaHJvbml6YXRpb24gZXZlbnRzIHdpdGhpbiBzYW1lIGFjY291bnRcbiAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgZXZlbnQgbGFiZWwgbmFtZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYWJsZSBhc3luYyBvciByZWd1bGFyIGZ1bmN0aW9uIHRvIGV4ZWN1dGVcbiAgICovXG4gIHF1ZXVlRXZlbnQobmFtZSwgY2FsbGFibGUpIHtcbiAgICB0aGlzLl93ZWJzb2NrZXRDbGllbnQucXVldWVFdmVudCh0aGlzLl9tZXRhQXBpQ29ubmVjdGlvbi5hY2NvdW50LmlkLCBuYW1lLCBjYWxsYWJsZSk7XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2VzIHRoZSBjb25uZWN0aW9uLiBUaGUgaW5zdGFuY2Ugb2YgdGhlIGNsYXNzIHNob3VsZCBubyBsb25nZXIgYmUgdXNlZCBhZnRlciB0aGlzIG1ldGhvZCBpcyBpbnZva2VkLlxuICAgKi9cbiAgYXN5bmMgY2xvc2UoKSB7XG4gICAgaWYoIXRoaXMuX2Nsb3NlZCl7XG4gICAgICBmb3IgKGxldCBsaXN0ZW5lciBvZiB0aGlzLl9zeW5jaHJvbml6YXRpb25MaXN0ZW5lcnMpIHtcbiAgICAgICAgdGhpcy5fd2Vic29ja2V0Q2xpZW50LnJlbW92ZVN5bmNocm9uaXphdGlvbkxpc3RlbmVyKHRoaXMuX21ldGFBcGlDb25uZWN0aW9uLmFjY291bnQuaWQsIGxpc3RlbmVyKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2Nsb3NlZCA9IHRydWU7XG4gICAgICBhd2FpdCB0aGlzLl9tZXRhQXBpQ29ubmVjdGlvbi5jbG9zZSh0aGlzLmluc3RhbmNlSWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHN5bmNocm9uaXphdGlvbiBzdGF0dXNcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gc3luY2hyb25pemF0aW9uIHN0YXR1c1xuICAgKi9cbiAgZ2V0IHN5bmNocm9uaXplZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWV0YUFwaUNvbm5lY3Rpb24uc3luY2hyb25pemVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgTWV0YUFwaSBhY2NvdW50XG4gICAqIEByZXR1cm4ge01ldGF0cmFkZXJBY2NvdW50fSBNZXRhQXBpIGFjY291bnRcbiAgICovXG4gIGdldCBhY2NvdW50KCkge1xuICAgIHJldHVybiB0aGlzLl9tZXRhQXBpQ29ubmVjdGlvbi5hY2NvdW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgY29ubmVjdGlvbiBoZWFsdGggbW9uaXRvciBpbnN0YW5jZVxuICAgKiBAcmV0dXJuIHtDb25uZWN0aW9uSGVhbHRoTW9uaXRvcn0gY29ubmVjdGlvbiBoZWFsdGggbW9uaXRvciBpbnN0YW5jZVxuICAgKi9cbiAgZ2V0IGhlYWx0aE1vbml0b3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21ldGFBcGlDb25uZWN0aW9uLmhlYWx0aE1vbml0b3I7XG4gIH1cblxufVxuIl0sIm5hbWVzIjpbIlRlcm1pbmFsU3RhdGUiLCJDb25uZWN0aW9uSGVhbHRoTW9uaXRvciIsIkxvZ2dlck1hbmFnZXIiLCJNZXRhQXBpQ29ubmVjdGlvbkluc3RhbmNlIiwiU3RyZWFtaW5nTWV0YUFwaUNvbm5lY3Rpb25JbnN0YW5jZSIsImNvbm5lY3QiLCJfb3BlbmVkIiwiX21ldGFBcGlDb25uZWN0aW9uIiwiaW5zdGFuY2VJZCIsImVyciIsImNsb3NlIiwicmVtb3ZlQXBwbGljYXRpb24iLCJzdWJzY3JpYmVUb01hcmtldERhdGEiLCJzeW1ib2wiLCJzdWJzY3JpcHRpb25zIiwidGltZW91dEluU2Vjb25kcyIsIndhaXRGb3JRdW90ZSIsIl9jaGVja0lzQ29ubmVjdGlvbkFjdGl2ZSIsInVuc3Vic2NyaWJlRnJvbU1hcmtldERhdGEiLCJzdWJzY3JpYmVkU3ltYm9scyIsInNhdmVVcHRpbWUiLCJ1cHRpbWUiLCJfd2Vic29ja2V0Q2xpZW50IiwiYWNjb3VudCIsImlkIiwidGVybWluYWxTdGF0ZSIsImhpc3RvcnlTdG9yYWdlIiwiYWRkU3luY2hyb25pemF0aW9uTGlzdGVuZXIiLCJsaXN0ZW5lciIsIl9zeW5jaHJvbml6YXRpb25MaXN0ZW5lcnMiLCJwdXNoIiwicmVtb3ZlU3luY2hyb25pemF0aW9uTGlzdGVuZXIiLCJmaWx0ZXIiLCJsIiwid2FpdFN5bmNocm9uaXplZCIsIm9wdHMiLCJxdWV1ZUV2ZW50IiwibmFtZSIsImNhbGxhYmxlIiwiX2Nsb3NlZCIsInN5bmNocm9uaXplZCIsImhlYWx0aE1vbml0b3IiLCJjb25zdHJ1Y3RvciIsIndlYnNvY2tldENsaWVudCIsIm1ldGFBcGlDb25uZWN0aW9uIiwiX2xvZ2dlciIsImdldExvZ2dlciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLE9BQU9BLG1CQUFtQixrQkFBa0I7QUFDNUMsT0FBT0MsNkJBQTZCLDRCQUE0QjtBQUNoRSxPQUFPQyxtQkFBbUIsWUFBWTtBQUN0QyxPQUFPQywrQkFBK0IsOEJBQThCO0FBS3JELElBQUEsQUFBTUMscUNBQU4sTUFBTUEsMkNBQTJDRDtJQWM5RDs7O0dBR0Ms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